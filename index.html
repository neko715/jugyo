<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学校の時間割トラッカー</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .tab {
            display: flex;
            cursor: pointer;
        }
        .tab button {
            padding: 10px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            margin-right: 5px;
            transition: background 0.3s ease;
        }
        .tab button.active {
            background: #ddd;
            font-weight: bold;
        }
        .content {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            width: 100%;
            transform: translateX(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .content.active {
            visibility: visible;
            opacity: 1;
            position: relative;
        }
        .slide-right {
            transform: translateX(50px);
        }
        .slide-left {
            transform: translateX(-50px);
        }
        .content.active.slide-right,
        .content.active.slide-left {
            transform: translateX(0);
        }
        .adjust-controls {
            margin-top: 20px;
        }
        .adjust-controls button {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>学校の時間割トラッカー</h1>
    <div class="tab">
        <button class="tab-button" data-target="normal">通常日課</button>
        <button class="tab-button" data-target="short-no-lunch">短縮４時間日課（給食なし）</button>
        <button class="tab-button" data-target="short-with-lunch">短縮４時間日課（給食あり）</button>
    </div>

    <div id="normal" class="content">
        <h2>通常日課</h2>
        <p id="normal-status"></p>
    </div>

    <div id="short-no-lunch" class="content">
        <h2>短縮４時間日課（給食なし）</h2>
        <p id="short-no-lunch-status"></p>
    </div>

    <div id="short-with-lunch" class="content">
        <h2>短縮４時間日課（給食あり）</h2>
        <p id="short-with-lunch-status"></p>
    </div>

    <div class="adjust-controls">
        <button id="adjust-earlier">早める</button>
        <button id="adjust-later">遅める</button>
        <label>
            <input type="number" id="adjust-seconds" value="5"> 秒
        </label>
    </div>

    <script>
        let timeOffset = 0; // 秒単位の調整

        const schedule = {
            normal: [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: 'スキル・読書', start: '8:20', end: '8:35' },
                { period: '1枚時', start: '8:40', end: '9:25' },
                { period: '2枚時', start: '9:30', end: '10:15' },
                { period: '業間休み', start: '10:15', end: '10:30' },
                { period: '3枚時', start: '10:30', end: '11:15' },
                { period: '4枚時', start: '11:20', end: '12:05' },
                { period: '昼食', start: '12:10', end: '13:00' },
                { period: 'ふれあいタイム', start: '13:05', end: '13:45', wednesday: true },
                { period: '5枚時', start: '13:50', end: '14:35' },
                { period: '6枚時', start: '14:40', end: '15:25' },
            ],
            shortNoLunch: [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: '1枚時', start: '8:25', end: '9:10' },
                { period: '2枚時', start: '9:15', end: '10:00' },
                { period: '業間休み', start: '10:00', end: '10:10' },
                { period: '3枚時', start: '10:10', end: '10:55' },
                { period: '4枚時', start: '11:00', end: '11:45' },
            ],
            shortWithLunch: [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: 'スキル・読書', start: '8:20', end: '8:35' },
                { period: '1枚時', start: '8:40', end: '9:25' },
                { period: '2枚時', start: '9:30', end: '10:15' },
                { period: '業間休み', start: '10:15', end: '10:30' },
                { period: '3枚時', start: '10:30', end: '11:15' },
                { period: '4枚時', start: '11:20', end: '12:05' },
                { period: '昼食', start: '12:10', end: '13:00' },
            ],
        };

        function parseTime(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, -timeOffset);
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        function getStatus(schedule, isWednesday) {
            const now = new Date(new Date().getTime() + timeOffset * 1000);

            for (let i = 0; i < schedule.length; i++) {
                const period = schedule[i];
                if (period.wednesday && !isWednesday) continue;

                const start = parseTime(period.start);
                const end = parseTime(period.end);

                if (now >= start && now <= end) {
                    const remainingTime = Math.max(0, Math.round((end - now) / 1000));
                    const minutes = Math.floor(remainingTime / 60);
                    const seconds = remainingTime % 60;
                    return `${period.period}中です。あと<strong>${minutes}分${seconds}秒</strong>で終了します（${formatTime(end)}に終了）。※クラブ/委員会/千教研はまだ非対応`;
                } else if (now < start) {
                    const remainingTime = Math.max(0, Math.round((start - now) / 1000));
                    const minutes = Math.floor(remainingTime / 60);
                    const seconds = remainingTime % 60;
                    return `${period.period}はあと<strong>${minutes}分${seconds}秒</strong>で開始します（${formatTime(start)}に開始）。`;
                }
            }
            return '現在、授業時間外です。';
        }

        function updateStatuses() {
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0 = 日曜日, 1 = 月曜日, ..., 6 = 土曜日
            const isWednesday = (dayOfWeek === 3);

            document.getElementById('normal-status').innerHTML = getStatus(schedule.normal, isWednesday);
            document.getElementById('short-no-lunch-status').innerHTML = getStatus(schedule.shortNoLunch, false);
            document.getElementById('short-with-lunch-status').innerHTML = getStatus(schedule.shortWithLunch, false);
        }

        document.getElementById('adjust-earlier').addEventListener('click', () => {
            const adjustValue = parseInt(document.getElementById('adjust-seconds').value, 10) || 0;
            timeOffset -= adjustValue;
        });

        document.getElementById('adjust-later').addEventListener('click', () => {
            const adjustValue = parseInt(document.getElementById('adjust-seconds').value, 10) || 0;
            timeOffset += adjustValue;
        });

        let currentTab = null;

        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                document.querySelectorAll('.content').forEach(content => {
                    content.classList.remove('active', 'slide-left', 'slide-right');
                });

                const targetContent = document.getElementById(button.dataset.target);

                if (currentTab) {
                    const direction = currentTab.compareDocumentPosition(targetContent) & Node.DOCUMENT_POSITION_FOLLOWING ? 'slide-right' : 'slide-left';
                    targetContent.classList.add(direction);
                }

                targetContent.classList.add('active');
                currentTab = targetContent;
            });
        });

        document.querySelector('.tab-button').click();
        updateStatuses();
        setInterval(updateStatuses, 1000);
    </script>
</body>
</html>
