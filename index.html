<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時間割トラッカー</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .tab {
            display: flex;
            cursor: pointer;
            margin-top: 20px;
        }
        .tab button {
            padding: 10px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            margin-right: 5px;
            transition: background 0.3s ease;
        }
        .tab button.active {
            background: #ddd;
            font-weight: bold;
        }
        .content {
            display: none;
        }
        .content.active {
            display: block;
        }
        .toggle {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: #ccc;
            border-radius: 10px;
            margin-right: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch:before {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        .toggle-switch.on {
            background: #4caf50;
        }
        .toggle-switch.on:before {
            transform: translateX(20px);
        }
    </style>
</head>
<body>
    <p>※クラブ/委員会はまだ非対応</p>

    <div class="toggle">
        <div id="elapsed-time-toggle" class="toggle-switch"></div>
        <label for="elapsed-time-toggle">経過時間</label>
    </div>

    <!-- タブの上部に配置 -->
    <div class="tab">
        <button class="tab-button" data-target="normal">通常日課</button>
        <button class="tab-button" data-target="short-no-lunch">短縮４時間日課（給食なし）</button>
        <button class="tab-button" data-target="short-with-lunch">短縮４時間日課（給食あり）</button>
    </div>

    <div id="normal" class="content">
        <h2>通常日課</h2>
        <p id="normal-status"></p>
    </div>

    <div id="short-no-lunch" class="content">
        <h2>短縮４時間日課（給食なし）</h2>
        <p id="short-no-lunch-status"></p>
    </div>

    <div id="short-with-lunch" class="content">
        <h2>短縮４時間日課（給食あり）</h2>
        <p id="short-with-lunch-status"></p>
    </div>

    <div id="schedule">
        <h2>今日の日程</h2><p>※日程は毎週月曜日の時点<p>
        <ul id="today-schedule"></ul>
    </div>

    <script>
        const timeOffset = 5; // 5秒進める固定調整
        let showElapsedTime = false;

        // スケジュールデータ
        const schedules = {
            normal: [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: 'スキル・読書', start: '8:20', end: '8:35' },
                { period: '1時間目', start: '8:40', end: '9:25' },
                { period: '2時間目', start: '9:30', end: '10:15' },
                { period: '業間休み', start: '10:15', end: '10:30' },
                { period: '3時間目', start: '10:35', end: '11:20' },
                { period: '4時間目', start: '11:25', end: '12:10' },
                { period: '昼食', start: '12:10', end: '12:55' },
                { period: '昼休み', start: '12:55', end: '13:15' },
                { period: '5時間目', start: '13:40', end: '14:25' },
                { period: '6時間目', start: '14:30', end: '15:15' },
            ],
            'short-no-lunch': [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: '1時間目', start: '8:25', end: '9:10' },
                { period: '2時間目', start: '9:15', end: '10:00' },
                { period: '業間休み', start: '10:00', end: '10:05' },
                { period: '3時間目', start: '10:10', end: '10:55' },
                { period: '4時間目', start: '11:00', end: '11:55' },
            ],
            'short-with-lunch': [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: 'スキル・読書', start: '8:20', end: '8:35' },
                { period: '1時間目', start: '8:40', end: '9:25' },
                { period: '2時間目', start: '9:30', end: '10:15' },
                { period: '業間休み', start: '10:15', end: '10:20' },
                { period: '3時間目', start: '10:25', end: '11:10' },
                { period: '4時間目', start: '11:15', end: '12:00' },
                { period: '昼食', start: '12:00', end: '12:45' },
            ],
        };

        const weeklySchedule = {
            月曜日: [
                "1時間目: 算数",
                "2時間目: 図工",
                "3時間目: 図工",
                "4時間目: 社会",
                "5時間目: りか",
                "6時間目: なし",
            ],
            火曜日: [
                "1時間目: 国語",
                "2時間目: 算数",
                "3時間目: 総合",
                "4時間目: 算数",
                "5時間目: 書写",
                "6時間目: 社会",
            ],
            水曜日: [
                "1時間目: 英語",
                "2時間目: 体育",
                "3時間目: 算数",
                "4時間目: 社会",
                "5時間目: 国語",
                "6時間目: クラブ",
            ],
            木曜日: [
                "1時間目: 理科",
                "2時間目: 理科",
                "3時間目: 道徳",
                "4時間目: 国語",
                "5時間目: 算数",
                "6時間目: 英語",
            ],
            金曜日: [
                "1時間目: 体育",
                "2時間目: 社会",
                "3時間目: 英語",
                "4時間目: 家庭",
                "5時間目: 図書",
                "6時間目: なし",
            ],
        };

        function parseTime(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function getStatus(schedule) {
            const now = new Date(new Date().getTime() + timeOffset * 1000);

            for (let i = 0; i < schedule.length; i++) {
                const period = schedule[i];
                const start = parseTime(period.start);
                const end = parseTime(period.end);

                if (now >= start && now <= end) {
                    const elapsedTime = Math.round((now - start) / 1000);
                    const elapsedMinutes = Math.floor(elapsedTime / 60);
                    const elapsedSeconds = elapsedTime % 60;

                    const remainingTime = Math.round((end - now) / 1000);
                    const remainingMinutes = Math.floor(remainingTime / 60);
                    const remainingSeconds = remainingTime % 60;

                    return `${period.period}中です。<br>
                        残り時間: <strong>${remainingMinutes}分${remainingSeconds}秒</strong><br>
                        ${
                            showElapsedTime
                                ? `経過時間: <strong>${elapsedMinutes}分${elapsedSeconds}秒</strong>`
                                : ""
                        }`;
                } else if (now < start) {
                    const timeToStart = Math.round((start - now) / 1000);
                    const minutesToStart = Math.floor(timeToStart / 60);
                    const secondsToStart = timeToStart % 60;

                    return `${period.period}はあと<strong>${minutesToStart}分${secondsToStart}秒</strong>で開始します。`;
                }
            }

            return '現在、授業時間外です。';
        }

        function updateStatuses() {
            for (const [key, schedule] of Object.entries(schedules)) {
                const statusElement = document.getElementById(`${key}-status`);
                if (statusElement) {
                    statusElement.innerHTML = getStatus(schedule);
                }
            }
        }

        function getTodaySchedule() {
            const days = ["日曜日", "月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日"];
            const today = new Date().getDay();
            const todayName = days[today];

            if (weeklySchedule[todayName]) {
                return weeklySchedule[todayName];
            } else {
                return ["本日は授業がありません。"];
            }
        }

        function displayTodaySchedule() {
            const todaySchedule = getTodaySchedule();
            const scheduleElement = document.getElementById("today-schedule");
            scheduleElement.innerHTML = "";

            todaySchedule.forEach((item) => {
                const li = document.createElement("li");
                li.textContent = item;
                scheduleElement.appendChild(li);
            });
        }

        // タブの切り替え処理
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach((button) => {
            button.addEventListener('click', (event) => {
                const target = event.target.dataset.target;

                // タブのアクティブ状態を切り替え
                tabButtons.forEach((btn) => btn.classList.remove('active'));
                button.classList.add('active');

                // コンテンツの表示切り替え
                const contents = document.querySelectorAll('.content');
                contents.forEach((content) => {
                    content.classList.remove('active');
                    if (content.id === target) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // 初期表示
        document.querySelector('.tab-button').classList.add('active');
        document.getElementById('normal').classList.add('active');
        displayTodaySchedule();
        updateStatuses();

        // 経過時間トグルの切り替え
        const toggleSwitch = document.getElementById('elapsed-time-toggle');
        toggleSwitch.addEventListener('click', () => {
            showElapsedTime = !showElapsedTime;
            toggleSwitch.classList.toggle('on');
            updateStatuses(); // 更新
        });

        // 一定時間ごとにステータスを更新
        setInterval(() => {
            updateStatuses();
            displayTodaySchedule();
        }, 1000); // 1秒ごとに更新
    </script>
</body>
</html>
