<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時間割トラッカー</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .tab {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .tab button {
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
            background-color: #fff;
            margin: 0 10px;
            font-size: 16px;
            color: #555;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab button:hover {
            background-color: #f0f0f0;
        }
        .tab button.active {
            background-color: #007bff;
            color: #fff;
            font-weight: bold;
            transform: scale(1.1);
        }
        .tab button:active {
            background-color: #0056b3;
            transform: scale(0.98);
        }
        .content {
            display: none;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        .content.active {
            display: block;
        }
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .schedule-table th, .schedule-table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .schedule-table th {
            background-color: #f1f1f1;
            font-weight: bold;
        }
        .schedule-table td {
            background-color: #fff;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>時間割トラッカー</h1>
            <p>※クラブ/委員会はまだ非対応</p>
            <p style="color: gray; font-size: small;">デザインアップデートが適応されました。</p>
            <p>
                <a href="https://docs.google.com/document/d/15sjPownQcOR7HxQz9-So8QapoDrQG9z2srC_9cqQw64/edit?usp=sharing" target="_blank">ソースコードを開く</a>
            </p>
        </div>
        <div class="tab">
            <button class="tab-button active" data-target="normal">通常日課</button>
            <button class="tab-button" data-target="short-no-lunch">短縮４時間日課（給食なし）</button>
            <button class="tab-button" data-target="short-with-lunch">短縮４時間日課（給食あり）</button>
        </div>
        <div id="normal" class="content active">
            <h2>通常日課</h2>
            <p id="normal-status"></p>
        </div>
        <div id="short-no-lunch" class="content">
            <h2>短縮４時間日課（給食なし）</h2>
            <p id="short-no-lunch-status"></p>
        </div>
        <div id="short-with-lunch" class="content">
            <h2>短縮４時間日課（給食あり）</h2>
            <p id="short-with-lunch-status"></p>
        </div>
        <div id="schedule-container">
            <h2>今日の時間割</h2>
            <table id="today-schedule" class="schedule-table">
                <thead>
                    <tr>
                        <th>時間</th>
                        <th>授業内容</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="footer">
            <p>作成者: 小柳 丈太郎</p>
        </div>
    </div>
    <script>
        const tables = {
            normal: [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: 'スキル・読書', start: '8:20', end: '8:35' },
                { period: '1時間目', start: '8:40', end: '9:25' },
                { period: '2時間目', start: '9:30', end: '10:15' },
                { period: '業間休み', start: '10:15', end: '10:30' },
                { period: '3時間目', start: '10:35', end: '11:20' },
                { period: '4時間目', start: '11:25', end: '12:10' },
                { period: '昼食', start: '12:10', end: '12:55' },
                { period: '昼休み', start: '12:55', end: '13:15' },
                { period: '5時間目', start: '13:40', end: '14:25' },
                { period: '6時間目', start: '14:30', end: '15:15' },
            ],
            'short-no-lunch': [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: '1時間目', start: '8:25', end: '9:10' },
                { period: '2時間目', start: '9:15', end: '10:00' },
                { period: '業間休み', start: '10:00', end: '10:05' },
                { period: '3時間目', start: '10:10', end: '10:55' },
                { period: '4時間目', start: '11:00', end: '11:55' },
            ],
            'short-with-lunch': [
                { period: '朝の会', start: '8:10', end: '8:20' },
                { period: 'スキル・読書', start: '8:20', end: '8:35' },
                { period: '1時間目', start: '8:40', end: '9:25' },
                { period: '2時間目', start: '9:30', end: '10:15' },
                { period: '業間休み', start: '10:15', end: '10:20' },
                { period: '3時間目', start: '10:25', end: '11:10' },
                { period: '4時間目', start: '11:15', end: '12:00' },
                { period: '昼食', start: '12:00', end: '12:45' },
            ],
        };

        const weeklySchedule = {
            月曜日: [
                " 図工　卒業制作",
                " 音楽",
                " 理科　水溶液の性質と働き",
                " 社会　新しい日本　平和な日本へ",
                " 書写　青木先生",
                " なし",
            ],
            火曜日: [
                " 建",
                " 国",
                " 記",
                " 日",
                " ！",
                " ！",
            ],
            水曜日: [
                " 英語 My future",
                " 理科　水溶液の性質と働き",
                " 国語　津田梅子",
                " 送る会練習②",
                " 社会　新しい日本　平和な日本へ",
                " 児童会　委員会活動",
            ],
            木曜日: [
                " 理科　地球に生きる",
                " 理科　地球に生きる",
                " 音楽",
                " 図工　卒業制作",
                " 英語 My future",
                " 送る会練習③",
            ],
            金曜日: [
                " 国語　津田梅子",
                " 算数　6年間のまとめ",
                " 図工　卒業制作",
                " 総合　未来へのパスポート",
                " 図書　図書室→国語",
                " 送る会練習④",
            ],
        };

        let currentScheduleType = 'normal';

        function getAdjustedTime() {
            const now = new Date();
            now.setSeconds(now.getSeconds() + 6); // 6秒を加算
            return now;
        }

        function parseTime(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const now = getAdjustedTime();
            return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
        }

        function updateTime() {
            const now = getAdjustedTime();
            const currentPeriod = tables[currentScheduleType].find(period => {
                const periodStartTime = parseTime(period.start);
                const periodEndTime = parseTime(period.end);
                return now >= periodStartTime && now <= periodEndTime;
            });
            const statusElement = document.getElementById(`${currentScheduleType}-status`);
            if (currentPeriod) {
                const periodStartTime = parseTime(currentPeriod.start);
                const periodEndTime = parseTime(currentPeriod.end);
                const elapsedTime = now - periodStartTime; // 経過時間
                const remainingTime = periodEndTime - now; // 残り時間
                const minutesElapsed = Math.floor(elapsedTime / 60000);
                const secondsElapsed = Math.floor((elapsedTime % 60000) / 1000);
                const minutesRemaining = Math.floor(remainingTime / 60000);
                const secondsRemaining = Math.floor((remainingTime % 60000) / 1000);
                statusElement.innerHTML = `${currentPeriod.period} - 残り時間: ${minutesRemaining}分 ${secondsRemaining}秒 <br> 経過時間: ${minutesElapsed}分 ${secondsElapsed}秒`;
            } else {
                statusElement.textContent = "授業が始まってないもしくは授業が一日分終わりました。";
            }

            // 休み時間の場合の処理
            const breakPeriod = tables[currentScheduleType].find(period => period.period.includes('休み') && now >= parseTime(period.start) && now <= parseTime(period.end));
            if (breakPeriod) {
                const breakStartTime = parseTime(breakPeriod.start);
                const breakEndTime = parseTime(breakPeriod.end);
                const elapsedTime = now - breakStartTime; // 経過時間
                const remainingTime = breakEndTime - now; // 残り時間
                const minutesElapsed = Math.floor(elapsedTime / 60000);
                const secondsElapsed = Math.floor((elapsedTime % 60000) / 1000);
                const minutesRemaining = Math.floor(remainingTime / 60000);
                const secondsRemaining = Math.floor((remainingTime % 60000) / 1000);
                statusElement.innerHTML = `${breakPeriod.period} - 残り時間: ${minutesRemaining}分 ${secondsRemaining}秒 <br> 経過時間: ${minutesElapsed}分 ${secondsElapsed}秒`;
            }
        }

        function updateTodaySchedule() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const days = ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日'];
            const today = days[dayOfWeek];
            const tbody = document.querySelector('#today-schedule tbody');
            tbody.innerHTML = '';

            if (weeklySchedule[today]) {
                weeklySchedule[today].forEach((period, index) => {
                    const row = document.createElement('tr');
                    const timeCell = document.createElement('td');
                    const periodCell = document.createElement('td');
                    timeCell.textContent = `${index + 1}時間目`;
                    periodCell.textContent = period;
                    row.appendChild(timeCell);
                    row.appendChild(periodCell);
                    tbody.appendChild(row);
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateTodaySchedule();
            setInterval(updateTime, 1000); // 毎秒ごとに時間を更新

            const tabButtons = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    contents.forEach(content => content.classList.remove('active'));
                    document.getElementById(button.dataset.target).classList.add('active');

                    currentScheduleType = button.dataset.target;
                    updateTime();
                });
            });
        });
    </script>
</body>
</html>
